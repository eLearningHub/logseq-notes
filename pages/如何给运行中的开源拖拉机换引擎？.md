type:: [[Blog]]

-
- Proposal / Tracking Issue / Multiple PRs / Stay Focused / Ask For Help
-
- 最近完成了 Databend 存储模块的大重构，在不阻塞现有功能开发的前提下，基本无痛的完成了功能的实现。本文总结了我个人的一些经验，期望能够带来一些启发。
-
- 做重构不易，尤其是在一个相当活跃的 codebase 上。Databend 现在每周有 40+ PR 被 merge，在过去的一周中有 800+ 文件发生了变更，代码增加了 21K  行，删除了 12K 行。在这样的代码库上，毕全功于一役的代价是高到可怕的。所以在整个重构的生命周期中，我们都需要跟社区保持密切沟通，让社区知道你想做什么，怎么做，现在的进展如何。
-
- 从这一次的重构中我总结出了如下经验：
-
- Proposal
	- 正如 The Apache Way 所说：`Community over code`。一个好的开源项目不仅仅是由代码组成，抛开开源共同体谈抽象的技术和代码是没有意义的。因此向开源项目提交大型的变更之前，我们必须要阐述清楚自己的想法，解释动机，让开源共同体知道自己想做什么，想怎么做。
	- 这些落到纸面上的文档在讨论时能够补充信息，完善想法，构建出更好的设计。从长期角度看，文档能够帮助后来者理解当时为什么要提出这样的设计，从而避免重复踩坑。不仅如此，一份好的设计文档往往还能够影响、启发其他开源项目的设计，从而促进整个行业进步。
	- [@tison](https://github.com/tisonkun/) 在 [如何参与 Apache 项目社区](https://zhuanlan.zhihu.com/p/93334196) 提到过：
	- > 对于任何 non-trivial 的改动，都需要有一定的描述来表明动机；对于大的改动，更需要设计文档来留存记忆。人的记忆不是永久的，总会忘记最初的时候自己为什么做某一件事情，设计文档的沉淀对于社区摆脱人的不确定性演化有至关重要的作用。
	- 在本次重构之前，我在 Databend 的 [Discussions](https://github.com/datafuselabs/databend/discussions) 中向全体社区成员公开地阐述了自己的愿景和希望: [proposal: Vision of Databend DAL](https://github.com/datafuselabs/databend/discussions/3662)。然后跟多位相关的模块的维护者取得了沟通，达成了广泛的一致意见，之后才开始了本次的重构。我认为跟维护者取得一致是非常关键的步骤，否则极有可能出现工作到一半时维护者发现想法冲突导致工作被终止或者重来，这是非常沮丧的。
	- 此外，开源共同体本质上都在奉行**基于开源贡献**的精英主义原则。贡献者必须要通过贡献来证明自己的价值，取得社区的信任，然后才能推行自己的主张。所以在提出一个大型改动之前，最好先通过参与一些 good first issue 加入到社区中来，了解社区的规范，熟悉社区的编译流程，跟模块的维护者保持联系，建立自己在社区中的影响力。
	- 在本次重构之前，我帮助 Databend 社区完成了新的社区官网上线，改造了全新的 CI Pipeline，跟各个模块的维护者基本都刷了个脸熟。
	- 值得注意的是，Databend 像很多新生的开源项目一样，还没有完善的 Proposal 流程，但是这并不意味着我们就不能或者不需要提交 Proposal 了。提交 Proposal 的意义就在于跟社区沟通达成一致，不要被形式所束缚，只要能最终达成一致就是可以接受的。与此同时，开源项目的治理流程本身也在不断完善和演进。事实上，绝大多数项目中正式的 Proposal 处理流程正是在社区在不断的接受和处理一份份 Proposal 的过程中被搭建起来的。
- Tracking Issues
	- 在提交了 Proposal 通过之后，最好能创建一个 Tracking Issues 来跟踪 Proposal 的实现情况。
	- 通常我们会命名成 `Tracking Issue for Xxxx`，在这个 Issue 中，我们需要
		- 链接到之前通过的 Proposal 以便于社区成员了解当前工作的上下文
		- 列出自己的工作计划和 TODO List
		- 随进度更新自己的进展
	- 除了自己的规划安排之外，还有一种比较常见的情况是在 PR review 时维护者经常会提出一些后续的改进建议，我们可以统一汇总到 Tracking Issue 中来。
	- Tracking Issues 的意义在于让社区了解当前的进展并在适时的时候提供需要的帮助，社区通过查看 Tracking Issue 就能了解 Proposal 目前是处于活跃开发状态还是停滞状态，对 Proposal 实现感兴趣的成员也能够通过 Tracking Issue 反馈自己的想法和参与意愿。
	- 在本次重构中，我通过 [Tracking issue for Vision of Databend DAL](https://github.com/datafuselabs/databend/issues/3677) 来跟踪 Proposal 的进展情况。除了自己的规划的特性之外，我还记录了很多维护者 review 时提供的反馈意见和一些长期的不成熟想法，这些都是未来项目可以改进的方向。
- Multiple PRs
	-
- Stay Focused
	-
- Ask For Help