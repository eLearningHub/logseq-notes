title:: 2022-11: 新轮子 reqsign
type:: [[Blog]]

- 这周主要的时间都在搓新轮子 [reqsign](https://github.com/Xuanwo/reqsign)，用于对用户的请求进行签名，使得用户不再需要依赖完整的 SDK，我将其概括为 `Signing API requests without effort`。今天这期周报就主要聊聊为什么要造这个轮子，以及适合使用它的场景。
-
- 背景
	- 开发云上服务不可避免的会使用 SDK，它帮助用户处理认证，构造请求，解析响应等任务，使得用户不需要关心服务内部的细节。对于绝大多数用户来说，使用 SDK 已经足够满足需求，但是 SDK 也有不小的弊端。
	- 首先，不同服务的 SDK 维护质量参差不齐。大多数 SDK 都无法及时响应来自用户的需求，没有定期的漏洞补丁和安全审查。对小众语言来说这个问题尤为严重，以 Rust 为例，对象存储服务中提供官方 SDK 支持的只有 AWS S3，其他的服务都只有社区维护的 SDK。
	- 其次，跨 SDK 的行为很难统一。云上服务不可避免的会出现偶尔的内部错误和超时，所以很多 SDK 都包装了自己的重试和超时逻辑。应用如果想设置统一的重试和超时行为，就需要逐个服务的去研究如何进行配置。底层的数据库服务还会需要控制 SDK 内部的 Client ，控制并发， 限流限速，控制内存占用等，这就更难以实现了。
	- 最后，代码生成的 SDK 复杂而难用。为了降低 SDK 的维护成本，很多服务使用代码生成的方式来构建 SDK。为了统一内部不同服务的接口，往往需要增加无数层抽象，把简单的 HTTP API 变成了一大堆复杂的中间件。以 AWS 的 Rust SDK 为例，为了使用 `aws-rust-s3`，我们需要依赖 `aws-endpoint`，`aws-http`，`aws-sig-auth`，`aws-sigv4` 等一大包 crate。这个问题在业务只需要使用 SDK 中特定几个方法的时候变得尤为严重。
-