- Hyper dispatch dropped debug
	- 复现方式
	  collapsed:: true
		- https://github.com/TCeason/test
		- 使用如下语句建表
		  collapsed:: true
			- ```sql
			  create database db;
			  
			  create table db.t (
			  id1 int,
			  id2 int,
			  id3 int,
			  id4 int,
			  id5 int,
			  id6 int,
			  id7 int,
			  id8 int,
			  id9 int,
			  id10 int,
			  id11 int,
			  id12 int,
			  id13 int,
			  id14 int,
			  id15 int,
			  id16 int,
			  str1 String,
			  str2 String,
			  str3 String,
			  dt timestamp
			  );
			  ```
		- 然后加大并发量尝试插入
			- ```shell
			  ./bench8028 --thread-nums=10 --host=127.0.0.1 --user=root --password=root --port=3307 --batch-rows=1000 --total-rows=6000
			  ```
		- 一般会出现如下错误
			- ```rust
			  java.sql.BatchUpdateException: Code: 1068, displayText = Cannot join handle from context's runtime, cause: panic.
			          at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
			          at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
			          at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
			          at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)
			          at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)
			          at com.mysql.cj.util.Util.handleNewInstance(Util.java:192)
			          at com.mysql.cj.util.Util.getInstance(Util.java:167)
			          at com.mysql.cj.util.Util.getInstance(Util.java:174)
			          at com.mysql.cj.jdbc.exceptions.SQLError.createBatchUpdateException(SQLError.java:224)
			          at com.mysql.cj.jdbc.ClientPreparedStatement.executeBatchedInserts(ClientPreparedStatement.java:755)
			          at com.mysql.cj.jdbc.ClientPreparedStatement.executeBatchInternal(ClientPreparedStatement.java:426)
			          at com.mysql.cj.jdbc.StatementImpl.executeBatch(StatementImpl.java:795)
			          at demo.lambda$multiThreadImport$0(demo.java:67)
			          at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
			          at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
			          at java.base/java.lang.Thread.run(Thread.java:833)
			  Caused by: java.sql.SQLException: Code: 1068, displayText = Cannot join handle from context's runtime, cause: panic.
			          at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:129)
			          at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
			          at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
			          at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1098)
			          at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1046)
			          at com.mysql.cj.jdbc.ClientPreparedStatement.executeLargeUpdate(ClientPreparedStatement.java:1371)
			          at com.mysql.cj.jdbc.ClientPreparedStatement.executeBatchedInserts(ClientPreparedStatement.java:716)
			          ... 6 more
			  
			  ```
	- 初步分析
		- hyper 跨 runtime 运行时会出现 dispatch dropped 这样的问题
		- ```rust
		      pub(crate) fn try_send(&mut self, val: T) -> Result<RetryPromise<T, U>, T> {
		          if !self.can_send() {
		              return Err(val);
		          }
		          let (tx, rx) = oneshot::channel();
		          self.inner
		              .send(Envelope(Some((val, Callback::Retry(tx)))))
		              .map(move |_| rx)
		              .map_err(|mut e| (e.0).0.take().expect("envelope not dropped").0)
		      }
		  ```
		- 每次 req 发送的时候会创建一个 oneshot::channel，如果发送端被 drop 了，recv 的时候就会直接报错
		- backtrace
		  collapsed:: true
			- ```rust
			  2022-03-17T06:40:27.511419Z DEBUG hyper::client::pool: pooling idle connection for ("http", 127.0.0.1:9900)
			  2022-03-17T06:40:27.511221Z ERROR databend_query::servers::mysql::writers::query_result_writer: OnQuery Error: Code: 1068, displayText = Cannot join handle from context's runtime, cause: panic.
			  
			     0: common_exception::exception_code::<impl common_exception::exception::ErrorCode>::TokioError
			               at /home/xuanwo/Code/datafuselabs/databend/common/exception/src/exception_code.rs:36:66
			     1: core::ops::function::FnOnce::call_once
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/ops/function.rs:227:5
			     2: <core::result::Result<T,E> as common_exception::exception::ToErrorCode<T,E,CtxFn>>::map_err_to_code::{{closure}}
			               at /home/xuanwo/Code/datafuselabs/databend/common/exception/src/exception.rs:196:13
			     3: core::result::Result<T,E>::map_err
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/result.rs:842:27
			     4: <core::result::Result<T,E> as common_exception::exception::ToErrorCode<T,E,CtxFn>>::map_err_to_code
			               at /home/xuanwo/Code/datafuselabs/databend/common/exception/src/exception.rs:194:9
			     5: databend_query::servers::mysql::mysql_interactive_worker::InteractiveWorkerBase<W>::exec_query::{{closure}}::{{closure}}
			               at /home/xuanwo/Code/datafuselabs/databend/query/src/servers/mysql/mysql_interactive_worker.rs:342:28
			     6: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			     7: databend_query::servers::mysql::mysql_interactive_worker::InteractiveWorkerBase<W>::exec_query::{{closure}}
			               at /home/xuanwo/Code/datafuselabs/databend/query/src/servers/mysql/mysql_interactive_worker.rs:308:5
			     8: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			     9: databend_query::servers::mysql::mysql_interactive_worker::InteractiveWorkerBase<W>::do_query::{{closure}}::{{closure}}
			               at /home/xuanwo/Code/datafuselabs/databend/query/src/servers/mysql/mysql_interactive_worker.rs:286:57
			    10: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			    11: databend_query::servers::mysql::mysql_interactive_worker::InteractiveWorkerBase<W>::do_query::{{closure}}
			               at /home/xuanwo/Code/datafuselabs/databend/query/src/servers/mysql/mysql_interactive_worker.rs:270:5
			    12: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			    13: <databend_query::servers::mysql::mysql_interactive_worker::InteractiveWorker<W> as opensrv_mysql::AsyncMysqlShim<W>>::on_query::{{closure}}
			               at /home/xuanwo/Code/datafuselabs/databend/query/src/servers/mysql/mysql_interactive_worker.rs:176:47
			    14: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			    15: <core::pin::Pin<P> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/future.rs:124:9
			    16: opensrv_mysql::AsyncMysqlIntermediary<B,S>::run::{{closure}}
			               at /home/xuanwo/.cargo/git/checkouts/opensrv-2d23bfb068524349/9690be9/mysql/src/lib.rs:1083:30
			    17: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			    18: opensrv_mysql::AsyncMysqlIntermediary<B,S>::run_with_options::{{closure}}
			               at /home/xuanwo/.cargo/git/checkouts/opensrv-2d23bfb068524349/9690be9/mysql/src/lib.rs:835:17
			    19: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			    20: opensrv_mysql::AsyncMysqlIntermediary<B,S>::run_on::{{closure}}
			               at /home/xuanwo/.cargo/git/checkouts/opensrv-2d23bfb068524349/9690be9/mysql/src/lib.rs:815:66
			    21: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			    22: databend_query::servers::mysql::mysql_session::MySQLConnection::run_on_stream::{{closure}}::{{closure}}
			               at /home/xuanwo/Code/datafuselabs/databend/query/src/servers/mysql/mysql_session.rs:44:88
			    23: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/future/mod.rs:91:19
			    24: tokio::runtime::task::core::CoreStage<T>::poll::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/core.rs:161:17
			    25: tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/loom/std/unsafe_cell.rs:14:9
			    26: tokio::runtime::task::core::CoreStage<T>::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/core.rs:151:13
			    27: tokio::runtime::task::harness::poll_future::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:467:19
			    28: <core::panic::unwind_safe::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/panic/unwind_safe.rs:271:9
			    29: std::panicking::try::do_call
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panicking.rs:492:40
			    30: __rust_try
			    31: std::panicking::try
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panicking.rs:456:19
			    32: std::panic::catch_unwind
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panic.rs:137:14
			    33: tokio::runtime::task::harness::poll_future
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:455:18
			    34: tokio::runtime::task::harness::Harness<T,S>::poll_inner
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:103:27
			    35: tokio::runtime::task::harness::Harness<T,S>::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:57:15
			    36: tokio::runtime::task::raw::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/raw.rs:128:5
			    37: tokio::runtime::task::raw::RawTask::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/raw.rs:80:18
			    38: tokio::runtime::task::LocalNotified<S>::run
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/mod.rs:347:9
			    39: tokio::runtime::thread_pool::worker::Context::run_task::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/thread_pool/worker.rs:425:13
			    40: tokio::coop::with_budget::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/coop.rs:102:9
			    41: std::thread::local::LocalKey<T>::try_with
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/thread/local.rs:413:16
			    42: std::thread::local::LocalKey<T>::with
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/thread/local.rs:389:9
			    43: tokio::coop::with_budget
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/coop.rs:95:5
			        tokio::coop::budget
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/coop.rs:72:5
			        tokio::runtime::thread_pool::worker::Context::run_task
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/thread_pool/worker.rs:424:9
			    44: tokio::runtime::thread_pool::worker::Context::run
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/thread_pool/worker.rs:391:24
			    45: tokio::runtime::thread_pool::worker::run::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/thread_pool/worker.rs:376:17
			    46: tokio::macros::scoped_tls::ScopedKey<T>::set
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/macros/scoped_tls.rs:61:9
			    47: tokio::runtime::thread_pool::worker::run
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/thread_pool/worker.rs:373:5
			    48: tokio::runtime::thread_pool::worker::Launch::launch::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/thread_pool/worker.rs:352:45
			    49: <tokio::runtime::blocking::task::BlockingTask<T> as core::future::future::Future>::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/blocking/task.rs:42:21
			    50: tokio::runtime::task::core::CoreStage<T>::poll::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/core.rs:161:17
			    51: tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/loom/std/unsafe_cell.rs:14:9
			    52: tokio::runtime::task::core::CoreStage<T>::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/core.rs:151:13
			    53: tokio::runtime::task::harness::poll_future::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:467:19
			    54: <core::panic::unwind_safe::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/panic/unwind_safe.rs:271:9
			    55: std::panicking::try::do_call
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panicking.rs:492:40
			    56: __rust_try
			    57: std::panicking::try
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panicking.rs:456:19
			    58: std::panic::catch_unwind
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panic.rs:137:14
			    59: tokio::runtime::task::harness::poll_future
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:455:18
			    60: tokio::runtime::task::harness::Harness<T,S>::poll_inner
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:103:27
			    61: tokio::runtime::task::harness::Harness<T,S>::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/harness.rs:57:15
			    62: tokio::runtime::task::raw::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/raw.rs:128:5
			    63: tokio::runtime::task::raw::RawTask::poll
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/raw.rs:80:18
			    64: tokio::runtime::task::UnownedTask<S>::run
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/task/mod.rs:384:9
			    65: tokio::runtime::blocking::pool::Task::run
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/blocking/pool.rs:91:9
			    66: tokio::runtime::blocking::pool::Inner::run
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/blocking/pool.rs:308:17
			    67: tokio::runtime::blocking::pool::Spawner::spawn_thread::{{closure}}
			               at /home/xuanwo/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.17.0/src/runtime/blocking/pool.rs:288:17
			    68: std::sys_common::backtrace::__rust_begin_short_backtrace
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/sys_common/backtrace.rs:122:18
			    69: std::thread::Builder::spawn_unchecked_::{{closure}}::{{closure}}
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/thread/mod.rs:498:17
			    70: <core::panic::unwind_safe::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/panic/unwind_safe.rs:271:9
			    71: std::panicking::try::do_call
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panicking.rs:492:40
			    72: __rust_try
			    73: std::panicking::try
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panicking.rs:456:19
			    74: std::panic::catch_unwind
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/panic.rs:137:14
			    75: std::thread::Builder::spawn_unchecked_::{{closure}}
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/thread/mod.rs:497:30
			    76: core::ops::function::FnOnce::call_once{{vtable.shim}}
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/core/src/ops/function.rs:227:5
			    77: <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/alloc/src/boxed.rs:1854:9
			        <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/alloc/src/boxed.rs:1854:9
			        std::sys::unix::thread::Thread::new::thread_start
			               at /rustc/8769f4ef2fe1efddd1f072485f97f568e7328f79/library/std/src/sys/unix/thread.rs:108:17
			    78: start_thread
			    79: __clone
			  
			  ```
	- 一些尝试
		- 将 pool_max_idle_per_host 设置为 0，即关闭连接池，这个错误就不会再复现
			- 接下来重点看一下连接池相关的逻辑
			- 一个猜想是如果某个 conn 创建于 runtime A，在 runtime B 中尝试发送请求就会出现该问题
		-